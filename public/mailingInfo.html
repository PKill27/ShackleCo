<!DOCTYPE html>
<html>

<head>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="css/materialize.min.css" media="screen,projection" />
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /> </head>
<link type="text/css" rel="stylesheet" href="css/fontStyle.css" media="screen,projection" />
<script src="https://www.gstatic.com/firebasejs/6.2.2/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.0.4/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/6.2.2/firebase-auth.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-144540420-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-144540420-1');
</script>


<body>
    <title>Shackle CO</title>
    <!--JavaScript at end of body for optimized loading-->
    <div class="navbar-fixed">
        <nav class="light-blue accent-3">
            <div class="nav-wrapper">
                <a href="#!" class="brand-logo"><img src="images/logo_shackle_white_back.png" style="max-height:56px;"></a> <a href="#" data-target="mobile-demo" class="sidenav-trigger"><i class="material-icons">menu</i></a>
                <ul class="right hide-on-med-and-down">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="pre-made.html">Pre-Made</a></li>
                    <li><a href="custom.html">Custom Shackles</a></li>
                    <li><a href="towRopes.html">Custom Rigging</a></li>
                    <li><a href="about.html">About Soft Shackles</a></li>
                </ul>
            </div>
        </nav>
    </div>
    <ul class="sidenav" id="mobile-demo">
        <li><a href="index.html">Home</a></li>
        <li><a href="pre-made.html">Pre-Made</a></li>
        <li><a href="custom.html">Custom Shackles</a></li>
        <li><a href="towRopes.html">Custom Rigging</a></li>
        <li><a href="about.html">About Soft Shackles</a></li>
    </ul>
    <div class="slider fullscreen" style="position: fixed;
  top: 56px;
  left: 0;
  bottom: 0;
  right: 0;
  overflow: auto;
background-color:cyan ;">
        <ul class="slides">
            <li> <img src="images/IMG_0904.jpg">
                <div class="caption center-align">
                    <h3 class="white-text">Shipping Adress</h3>
                    <h6 class="light grey-text text-lighten-3">Please enter the location you would like your things to be shipped</h6> </div>
        </ul>
    </div>
    <div style="
   top: 100%;
  position: absolute;
                background-color:white; width:100%;">
        <div class="container">
        <div class="contact col l6 s12">
            <h3 class="light-blue-text text-accent-3 center">Thank you</h3>
            <form id="adressForm" class="center">
                <div class="row">
                    <p class="input-field col s12 m6">
                        <label class="light-blue-text text-accent-3">Adress Line 1</label>
                        <input type="text" name="first" id="adress" required> </p>
                    <p class="input-field col s12 m6">
                        <label class="light-blue-text text-accent-3">Unit Number(optional)</label>
                        <input type="text" name="company" id="number"> </p>
                </div>
                <div class="row">
                    <p class="input-field col s12 m6">
                        <label class="light-blue-text text-accent-3">State</label>
                        <input type="text" id="state" required> </p>
                    <p class="input-field col s12 m6">
                        <label class="light-blue-text text-accent-3">Email</label>
                        <input name="email" type="text" id="email" required> </p>
                </div>
                <div class="row">
                    <p class="input-field col s12 m6">
                        <label class="light-blue-text text-accent-3">Zipcode</label>
                        <input type="text" name="phone" id="zipcode" required> </p>
                    <p class="input-field col s12 m6">
                        <label class="light-blue-text text-accent-3">Country</label>
                        <input type="text" name="phone" id="country" required> </p>
                </div>
                <p class="full" class="input-field center">
                    <button type="submit" disabled id="check_out_button" class="waves-effect waves-light btn white light-blue accent-3 white-text">Pay Now</button>
                </p>
            </form>
        </div>
        </div>
        <footer class="page-footer light-blue accent-3">
            <div class="container">
                <div class="row">
                    <div class="col l6 s12">
                        <h5 class="white-text">Payment Information</h5>
                        <p class="grey-text text-lighten-4">We do not handle any credit card info ourselves we use a trusted 3rd party company, <a href="https://stripe.com">Stripe</a>. Additionally there is a flat rate of $5 for shipping on orders under $50.</p>
                    </div>
                    <div class="col l4 offset-l2 s12">
                        <h5 class="white-text">Links</h5>
                        <ul>
                            <li><a class="grey-text text-lighten-3" href="pre-made.html">Pre-Made</a></li>
                            <li><a class="grey-text text-lighten-3" href="custom.html">Custom Shackles</a></li>
                            <li><a class="grey-text text-lighten-3" href="about.html">About Soft Shackles</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-copyright">
                <div class="container"> @2019 Copyright </div>
            </div>
        </footer>
    </div>
</body>
<script src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
<script type="text/javascript" src="js/materialize.min.js"></script>
<script src="js/init.js"></script>
<script src="https://js.stripe.com/v3"></script>
<script>
    var checkString = localStorage.getItem('check');
    var checkObject = JSON.parse(checkString);
    var cartString = localStorage.getItem('cart');
    var cartObject = JSON.parse(cartString);
     var priceString = localStorage.getItem('totalCost');
        var price = parseFloat(priceString);
        console.log(price);
        if(price >= 50){
            
           }else{checkObject.push({
                sku: "sku_FVFZ7CLBTgrNkf",
                quantity: 1
            })}
    var firebaseConfig = {
        apiKey: "AIzaSyAzvlKym2EdAvdk3JbZY5O8o9n0wHWN2CQ",
        authDomain: "contact-input.firebaseapp.com",
        databaseURL: "https://contact-input.firebaseio.com",
        projectId: "contact-input",
        storageBucket: "",
        messagingSenderId: "1002759570622",
        appId: "1:1002759570622:web:f68bec4d3361c2b2"
    };
    // Initialize Firebase
    //firebase.initializeApp(firebaseConfig);
    // Reference messages collection
    //var orderRef = firebase.database().ref('order');
    //listen to submit form calls submit form
    document.getElementById("adressForm").addEventListener("submit", submitForm);

    function submitForm(e) {
        e.preventDefault();
        var adress = {
            adress: getInputVal('adress')
        };
        var state = {
            state: getInputVal('state')
        };
        var email = {
            email: getInputVal('email')
        };
        var zipcode = {
            zipcode: getInputVal('zipcode')
        };
        var country = {
            county: getInputVal('country')
        };
        var unit = {
            unit: getInputVal('number')
        };
        var mailAdress = [];
        mailAdress.push(state);
        mailAdress.push(email);
        mailAdress.push(zipcode);
        mailAdress.push(country);
        mailAdress.push(unit);
        var completeOrder = [];
        completeOrder.push({
            items: cartObject,
            userInfo: mailAdress
        })
        completeOrder.push(cartObject);
        completeOrder.push(mailAdress);
        localStorage.setItem('completeOrder', JSON.stringify(completeOrder));
        //saveMessage(adress, state, email, zipcode, country, unit);
    }

    function getInputVal(id) {
        return document.getElementById(id).value;
    }
    // Save message to firebase
    function saveMessage(adress, state, email, zipcode, country, unit) {
        var newMessageRef = orderRef.push();
        newMessageRef.set({
            adress: adress,
            state: state,
            email: email,
            zipcode: zipcode,
            country: country,
            unit: unit,
            order: cartObject,
            paid: false
        });
    }
    
    $('#adress, #state, #zipcode, #email, #country').bind('keyup', function () {
        if (allFilled()) $('#check_out_button').removeAttr('disabled');
    });

    function allFilled() {
        var filled = true;
        console.log("hey");
        $('body input').each(function () {
            
            if ($(this).val() == ''&&$(this).attr('id')!="number") filled = false;
        });
        return filled;
    }
    var stripe = Stripe('pk_live_eBrh0Yx3CUNDALFENdKuaSg000IBlyxWvl');
    var checkoutButton = document.getElementById('check_out_button');
    checkoutButton.addEventListener('click', function () {
        // When the customer clicks on the button, redirect
        // them to Checkout.
        for (var i = 0; i < checkObject.length; i++) {
            if (checkObject[i].quantity == 0) {
                checkObject.splice(i, 1);
            }
        }
       
        
        console.log(checkObject);
        stripe.redirectToCheckout({
            items: checkObject, // Do not rely on the redirect to the successUrl for fulfilling
            // purchases, customers may not always reach the success_url after
            // a successful payment.
            // Instead use one of the strategies described in
            // https://stripe.com/docs/payments/checkout/fulfillment
            successUrl: 'https://shackleco.com/successPayment.html',
            cancelUrl: 'https://shackleco.com/mailingInfo.html',
            billingAddressCollection: 'required',
        }).then(function (result) {
            if (result.error) {
                // If `redirectToCheckout` fails due to a browser or network
                // error, display the localized error message to your customer.
                var displayError = document.getElementById('error-message');
                displayError.textContent = result.error.message;
            }
        });
    });
</script>

</html>